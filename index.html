<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="description"
      content="Clarin Facilities - Manutenção predial com excelência."
    />
    <meta
      name="keywords"
      content="Engenharia, Solda, Empresa, Facilities, Manutenção Predial, HTML, CSS"
    />
    <meta name="author" content="Lucas Amaral e Mateus de Melo" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta property="og:title" content="Clarin Facilities" />
    <meta
      property="og:description"
      content="Clarin Facilities, à disposição da sua empresa."
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@100..1000&family=Montserrat:wght@100..900&family=Poetsen+One&family=Roboto+Slab:wght@500&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="public/css/global.css" />
    <link rel="stylesheet" href="public/css/home.css" />
    <link rel="stylesheet" href="public/css/about.css" />
    <link rel="stylesheet" href="public/css/services.css" />
    <link rel="stylesheet" href="public/css/header.css" />
    <link rel="stylesheet" href="public/css/footer.css" />
    <link
      rel="shortcut icon"
      href="public/images/logo-maximus.png"
      type="image/x-icon"
    />
    <title>Maximus Segurança</title>
  </head>
  <body class="">
    <div id="header"></div>

    <main class="main-content">
      <div id="home"></div>
      <div id="services"></div>
      <!-- <div id="about"></div> -->
      <div id="footer"></div>
    </main>

    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
      // Função para corrigir caminhos de imagens após inserir HTML dinamicamente
      function fixImagePaths(container) {
        const images = container.querySelectorAll("img[src]");

        images.forEach((img) => {
          let src = img.getAttribute("src");
          if (!src) return;

          // Ignora URLs absolutas e data URIs
          if (
            src.startsWith("http") ||
            src.startsWith("data:") ||
            src.startsWith("//")
          ) {
            return;
          }

          // Se começar com /, já é um caminho absoluto da raiz
          if (src.startsWith("/")) {
            return;
          }

          // Converte caminho relativo para absoluto baseado na URL atual
          try {
            // Obtém o diretório base da URL atual
            const currentUrl = window.location.href;
            const baseUrl = currentUrl.substring(
              0,
              currentUrl.lastIndexOf("/") + 1
            );
            const absoluteUrl = new URL(src, baseUrl).href;

            // Define o src novamente para forçar o carregamento
            img.src = absoluteUrl;

            // Adiciona tratamento de erro para debug
            img.onerror = function () {
              console.warn(
                `Falha ao carregar imagem: ${absoluteUrl} (caminho original: ${src})`
              );
              // Tenta caminho alternativo
              const altSrc = src.startsWith("public/") ? src : `public/${src}`;
              const altUrl = new URL(altSrc, baseUrl).href;
              if (this.src !== altUrl) {
                this.src = altUrl;
              }
            };
          } catch (e) {
            console.error("Erro ao corrigir caminho da imagem:", src, e);
          }
        });
      }

      async function loadPartial(partialId, partialPath, callback) {
        try {
          const response = await fetch(partialPath);
          if (!response.ok) {
            throw new Error(
              `Erro ao carregar ${partialPath}: ${response.status}`
            );
          }
          const html = await response.text();
          const container = document.getElementById(partialId);
          container.innerHTML = html;

          // Corrigir caminhos de imagens após inserir HTML
          fixImagePaths(container);

          lucide.createIcons();

          if (partialId === "footer") {
            const currentDate = new Date();
            const year = currentDate.getFullYear();
            const footerBottom = container.querySelector(".footer-bottom-p");
            if (footerBottom) {
              footerBottom.innerHTML = `&copy; ${year} Clarin Facilities. Todos os direitos reservados.`;
            }
          }

          if (callback) callback();
        } catch (error) {
          console.error(`Erro ao carregar partial ${partialId}:`, error);
        }
      }

      loadPartial("header", "partials/header.html", () => {
        initHeaderEvents();
      });

      loadPartial("home", "partials/home.html");
      loadPartial("services", "partials/services.html", () => {
        if (typeof initSlideshow === "function") {
          initSlideshow();
        }
      });
      loadPartial("about", "partials/about.html");
      loadPartial("footer", "partials/footer.html");
    </script>

    <script src="public/js/services.js"></script>
    <script src="public/js/header.js"></script>
  </body>
</html>
